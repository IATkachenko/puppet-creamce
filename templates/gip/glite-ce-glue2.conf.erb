# Site Id
SiteId = <%=@sitename%>

#
#
# Computing Service Id
# Provided by yaim variable COMPUTING_SERVICE_ID (required if we are in cluster mode)
# Otherwise Computing Service Id is hostname + the "_ComputingElement" string
ComputingServiceId = <%=@computing_service_id%>
#
#
# NumberOfEndPointType
# 2 (CREAM-CE + RTEpublisher) if CEMon is deployed
# 3 otherwise 
NumberOfEndPointType = 2

#
#
# ImplementationVersion is the version of the CREAM service
ImplementationVersion=@creamversion@

#
#
# InterfaceVersion is the version of the Service interface
InterfaceVersion=2.1

#
#
# HealthStateHelper should be the full pathname of the /glite-info-service-test plus CREAM as argument
HealthStateHelper = /usr/bin/glite-info-service-test CREAM

#
#
# ServingState of the Computing Element. It should be usually set to production
ServingState = Production

#
#
# QualityLevel of the Service Element. It should be usually set to production
QualityLevel = <%=@ce_quality_level%>

#
#
# Owner should be the list of owner VO names
Owner =  <%=@voenv.keys().join(" ")%>  

#
#
# Argus is yes if this CREAM CE is using Argus as authorization mechanism
<% if @use_argus -%>
Argus = yes
<% else -%>
Argus = no
<% end -%>

#
#
# EMIES is yes if the CREAM CE provides the ES interface
EMIES = no

#
# 
#ACBR should be the list of AccessControlBaseRule strings to indicate who is allowed to 
# have access to the service - at the simplest this is the same as the
# Owner but with the VO names prefixed by "VO:"
<%acbrlist=''
@voenv.each do | vo, value | 
  acbrlist=acbrlist+" VO:"+vo 
end -%>
ACBR = <%=acbrlist%>

#
# ExecutionEnvironments
# The list of the ids of the Execution Environments
# Format: ExecutionEnvironments = (EE1, EE2, ..., EEn)
ExecutionEnvironments = (<%=@ce_host%>)

#
#
# CE_BATH_SYS is the batch system used by the CE. E.g. torque, lsf, etc
# It should be filled with the content of yaim variable CE_BATCH_SYS
CE_BATCH_SYS = <%=@batch_system%>

#
#
# BATCH_VERSION is the Version of the batch system
# It should be filled with the content of yaim variable BATCH_VERSION
BATCH_VERSION = <%=@batch_system-%>_<%=defined? @batchversion ? @batchversion : 'undef'%>

#
#
# CloseSEs is the list of the storage services close to this computing service
# Format: CloseSEs = (closeSE1, closeSE2, ..., closeSEn)
# Format of closeSEi: (StorageServiceid LocalPath RemotePath)
#CloseSEs = srm-lhcb.cern.ch srm-atlas.cern.ch srm-alice.cern.ch srm-cms.cern.ch srm-dteam.cern.ch srm-public.cern.ch srm-pps.cern.ch srm-eoscms.cern.ch srm-eosatlas.cern.ch
# 
<%CloseSEs=Array.new
CloseSEsFormatted=Array.new
@voenv.each do | vo, value |
  defaultSE = value['vo_default_se']
  if ! CloseSEs.include?(defaultSE)
    CloseSEs.push(defaultSE)
    seObj=@se_list[defaultSE]
    CloseSEsFormatted.push("("+ defaultSE + " " + seObj['mount_dir'] + " " + seObj['export_dir']+ ")")
  end
end-%>
CloseSEs = (<%=CloseSEsFormatted.join(', ')-%>)
#
#
# CE_CAPABILITY is the list of CE capabilities
# Format: CECapabilities = (capa1, capa2, ..., capaN)
CECapabilities = (<%=@ce_capability.join(",")-%>)

<%if @clustermode == 'false' -%>
# CE in non-cluster mode
#
#
#
<%
@subclusters.each do | res_id, res_info |
    ce_cpu_model=res_info["ce_cpu_model"]
    ce_cpu_speed=res_info["ce_cpu_speed"]
    ce_cpu_vendor=res_info["ce_cpu_vendor"]
    ce_inboundip=res_info["ce_inboundip"]
    ce_physcpu=res_info["ce_physcpu"]
    ce_logcpu=res_info["ce_logcpu"]
    ce_minphysmem=res_info["ce_minphysmem"]
    ce_minvirtmem=res_info["ce_minvirtmem"]
    ce_os=res_info["ce_os"]
    ce_os_name=res_info["ce_os_name"]
    ce_os_family=res_info["ce_os_family"].downcase
    ce_os_arch=res_info["ce_os_arch"].downcase
    ce_os_release=res_info["ce_os_release"]
    ce_os_version=res_info["ce_os_version"]
    ce_otherdescr=res_info["ce_otherdescr"]
    ce_outboundip=res_info["ce_outboundip"]
    ce_benchmarks=res_info["ce_benchmarks"]
    ce_smpsize=res_info["ce_smpsize"]
    ce_runtimeenv=res_info["ce_runtimeenv"]
    ce_cores=res_info["ce_cores"]
    if (ce_os_arch == "x86_64")
        ce_platform_type="amd64"
    else
        ce_platform_type=ce_os_arch
    end
    subcluster_tmpdir=res_info["subcluster_tmpdir"]
    subcluster_wntmdir=res_info["subcluster_wntmdir"]
-%>
# ArchitecturePlatformType is the Platform Type of the WNs of the 
# specified EE
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_OS_ARCH
ExecutionEnvironment_<%=res_id-%>_ArchitecturePlatformType = <%=ce_platform_type%>
#
# 
# PhysicalCPUs is the total number of real CPUs/physical chips, including 
# the nodes that are temporary down or offline 
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_PHYSCPU
ExecutionEnvironment_<%=res_id-%>_PhysicalCPUs = <%=ce_physcpu%>
#
#
# LogicalCPUs is the total number of cores/hyperthreaded CPUs, including the 
# nodes that are temporary down or offline
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_LOGCPU
ExecutionEnvironment_<%=res_id-%>_LogicalCPUs = <%=ce_logcpu%>
#
#
# SmpSize is the number of Logical CPUs (cores) of the WN
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_SMPSIZE 
ExecutionEnvironment_<%=res_id-%>_SmpSize = <%=ce_smpsize%>
#
# 
# ProcessorVendor is the name of the processor vendor for the Worker Nodes
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_CPU_VENDOR
ExecutionEnvironment_<%=res_id-%>_ProcessorVendor = <%=ce_cpu_vendor%>
#
#
# ProcessorModel is the name of the processor model as defined by the vendor 
# for the Worker Nodes
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_CPU_MODEL
ExecutionEnvironment_<%=res_id-%>_ProcessorModel = <%=ce_cpu_model%>
#
#
# ProcessorClockSpeed is the processor clock speed expressed in MHz for the 
# Worker Nodes 
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_CPU_SPEED
ExecutionEnvironment_<%=res_id-%>_ProcessorClockSpeed = <%=ce_cpu_speed%>
#
#
# MainMemoryRAMSize is the total physical memory of a WN expressed in MegaBytes
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_MINPHYSMEM 
ExecutionEnvironment_<%=res_id-%>_MainMemoryRAMSize = <%=ce_minphysmem%>
#
#
# MainMemoryVirtualSize is the total virtual memory of a WN expressed in 
# MegaBytes.
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_MINVIRTMEM
ExecutionEnvironment_<%=res_id-%>_MainMemoryVirtualSize = <%=ce_minvirtmem%>
#
# 
# OperatingSystemFamily should be filled with the OS family (e.g. linux)
# It must be set for all the Execution Environments
ExecutionEnvironment_<%=res_id-%>_OperatingSystemFamily = <%=ce_os_family%>
#
# 
# OperatingSystemName is the name of the operating system used on the Worker 
# Nodes 
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_OS
ExecutionEnvironment_<%=res_id-%>_OperatingSystemName = <%=ce_os_name%>
#
# 
# OperatingSystemRelease is the release of the operating system used on the 
# Worker Nodes
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_OS_RELEASE
ExecutionEnvironment_<%=res_id-%>_OperatingSystemRelease = <%=ce_os_release%>
# 
#
# NetworkAdapterInboundIP must be set to either FALSE or TRUE to express the 
# permission for inbound connectivity for the WNs
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_INBOUNDIP
ExecutionEnvironment_<%=res_id-%>_NetworkAdapterInboundIP = <%=ce_inboundip%>
#
#
# NetworkAdapterOutboundIP must be set to either FALSE or TRUE to express 
# the permission for outbound connectivity for the WNs
# It must be set for all the Execution Environments
# It should be filled with the content of yaim variable CE_OUTBOUNDIP
ExecutionEnvironment_<%=res_id-%>_NetworkAdapterOutboundIP = <%=ce_outboundip%>
#
#
# Benchmarks is the list of benchmarks
# Format: Benchmarks = (Benchmark1, Benchmark2, .., Benchmarkn)
# Format of Benchmarki: (Type Value)
<%
benchstr = nil
ce_benchmarks.each do | benchname, benchvalue |
  if benchstr == nil
    benchstr = "((#{benchname} #{benchvalue})"
  else
    benchstr << ", (#{benchname} #{benchvalue})"
  end
end
if benchstr == nil
  benchstr = "()"
else
  benchstr << ")"
end
-%>
ExecutionEnvironment_<%=res_id-%>_Benchmarks = test_<%=benchstr%>
#
#
# Cores is the number of cores per CPU of the Worker Nodes
# It must be set for all the Execution Environments
ExecutionEnvironment_<%=res_id-%>_Cores = <%=ce_cores%>
<%end-%>


<% 
sharelist=Array.new

@queue_vo_map.each do | queue, vodata |
  vodata.each do | owner, fqans |
     sharelist.push(queue + '_' + owner)
-%>
SHARE_<%=queue-%>_<%=owner-%>_QUEUENAME=<%=queue%>
<%# TODO implement access fqan-based -%>
SHARE_<%=queue-%>_<%=owner-%>_ACBRS=( VO:<%=owner-%> )
SHARE_<%=queue-%>_<%=owner-%>_OWNER=<%=owner%>
SHARE_<%=queue-%>_<%=owner-%>_ENDPOINTS=(<%=@ce_host-%>_org.glite.ce.CREAM)
SHARE_<%=queue-%>_<%=owner-%>_EXECUTIONENVIRONMENTS=(<%=@ce_host-%>)
SHARE_<%=queue-%>_<%=owner-%>_CEIDS=(<%=@ce_host-%>:<%=@ce_port-%>/<%=@ce_type-%>-<%=@batch_system-%>-<%=queue-%>)  

<%end-%>
<%end-%>

#
#
# Shares. The list of shares.
# Format: Shares = (share1, share2, ..., sharen)

Shares = ( <%=sharelist.join(',')-%> )

<%end-%>
