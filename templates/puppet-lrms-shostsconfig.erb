#!/bin/bash

# Generated by puppet

STATIC_HOSTS="<%=@lrms_host_list%>"

# TODO improve check on output
DYNAMIC_HOSTS=`<%=@lrms_host_script%> 2>/dev/null`

EXTRA_HOSTS="<%=@extra_host_list%>"

SHOSTS_FILE=/etc/ssh/shosts.equiv
KNOWN_FILE=/etc/ssh/ssh_known_hosts

KEY_TYPES="rsa1,rsa,dsa"

echo "#Generated by puppet, DO NOT EDIT" > ${SHOSTS_FILE}
for HOST in ${STATIC_HOSTS} ${DYNAMIC_HOSTS} ${EXTRA_HOSTS} ; do 
    echo "${HOST}" >> ${SHOSTS_FILE}
done

echo "#Generated by puppet, DO NOT EDIT" > ${KNOWN_FILE}
/usr/bin/ssh-keyscan -t ${KEY_TYPES} ${STATIC_HOSTS} ${DYNAMIC_HOSTS} ${EXTRA_HOSTS} >>${KNOWN_FILE} 2>/dev/null

exit 0



